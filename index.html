<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>電車充電查詢</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0fff0;
    }
    header {
      background-color: #2ecc71;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
    }
    .search-container {
      padding: 1rem;
      text-align: center;
    }
    input[type="text"] {
      width: 80%;
      padding: 0.5rem;
      font-size: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.8rem;
      text-align: center;
    }
    th {
      background-color: #27ae60;
      color: white;
      cursor: pointer;
    }
    tr:nth-child(even) {
      background-color: #f9fff9;
    }
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      th {
        position: sticky;
        top: 0;
      }
      td {
        border: none;
        border-bottom: 1px solid #ddd;
        padding: 0.6rem;
        text-align: left;
      }
    }
  </style>
</head>
<body>

<header>電車充電查詢</header>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="搜尋充電站或地區...">
</div>

<table id="chargingTable">
  <thead>
    <tr>
      <th onclick="sortTable('name')">充電站名稱</th>
      <th onclick="sortTable('distance')">距離 (km)</th>
      <th onclick="sortTable('price')">電價 (元/度)</th>
      <th>地址</th>
      <th>快/慢充</th>
    </tr>
  </thead>
  <tbody id="chargingBody">
    <!-- 資料會由JS填入 -->
  </tbody>
</table>

<script>
// 假資料
const chargingStations = [
  { name: "信義快充站", lat: 25.0330, lng: 121.5654, price: 6.0, address: "台北市信義路五段", type: "快充" },
  { name: "中山慢充站", lat: 25.0478, lng: 121.5319, price: 5.0, address: "台北市中山北路二段", type: "慢充" },
  { name: "板橋快充站", lat: 25.0130, lng: 121.4637, price: 5.5, address: "新北市板橋區中山路", type: "快充" },
  { name: "桃園慢充站", lat: 24.9936, lng: 121.3000, price: 4.8, address: "桃園市復興路", type: "慢充" },
  { name: "新竹快充站", lat: 24.8138, lng: 120.9675, price: 5.2, address: "新竹市光復路", type: "快充" }
];

let userLat = null, userLng = null;
let sortedBy = '';

function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // 地球半徑 km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI/180) * Math.cos(lat2 * Math.PI/180) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return (R * c).toFixed(2);
}

function updateTable() {
  const tbody = document.getElementById('chargingBody');
  tbody.innerHTML = '';
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  
  chargingStations.forEach(station => {
    if (!keyword || station.name.toLowerCase().includes(keyword) || station.address.toLowerCase().includes(keyword)) {
      const tr = document.createElement('tr');
      
      // 名稱 (可點擊導航)
      const nameTd = document.createElement('td');
      nameTd.innerHTML = `<a href="https://www.google.com/maps/search/?api=1&query=${station.lat},${station.lng}" target="_blank">${station.name}</a>`;
      tr.appendChild(nameTd);
      
      // 距離
      const distanceTd = document.createElement('td');
      distanceTd.textContent = station.distance ? station.distance : '定位中...';
      tr.appendChild(distanceTd);
      
      // 電價
      const priceTd = document.createElement('td');
      priceTd.textContent = station.price;
      tr.appendChild(priceTd);
      
      // 地址 (可點擊導航)
      const addressTd = document.createElement('td');
      addressTd.innerHTML = `<a href="https://www.google.com/maps/search/?api=1&query=${station.lat},${station.lng}" target="_blank">${station.address}</a>`;
      tr.appendChild(addressTd);
      
      // 快/慢充
      const typeTd = document.createElement('td');
      typeTd.textContent = station.type;
      tr.appendChild(typeTd);
      
      tbody.appendChild(tr);
    }
  });
}

function sortTable(field) {
  if (sortedBy === field) {
    chargingStations.reverse();
  } else {
    chargingStations.sort((a, b) => {
      if (field === 'distance') {
        return (parseFloat(a.distance) || Infinity) - (parseFloat(b.distance) || Infinity);
      } else if (field === 'price') {
        return a.price - b.price;
      } else {
        return a.name.localeCompare(b.name);
      }
    });
    sortedBy = field;
  }
  updateTable();
}

// 搜尋即時更新
document.getElementById('searchInput').addEventListener('input', updateTable);

// 取得使用者位置
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(position => {
    userLat = position.coords.latitude;
    userLng = position.coords.longitude;
    chargingStations.forEach(station => {
      station.distance = calculateDistance(userLat, userLng, station.lat, station.lng);
    });
    updateTable();
  }, error => {
    alert("無法取得定位，將不顯示距離");
    updateTable();
  });
} else {
  alert("瀏覽器不支援定位功能");
  updateTable();
}

// 初次載入
updateTable();
</script>

</body>
</html>
